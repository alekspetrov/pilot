import { Callout, Tabs } from 'nextra/components'

# Replay & Debug

Full execution recordings with interactive playback, analysis reports, and multi-format export.

<Callout type="info">
  Every task execution is automatically recorded to `~/.pilot/recordings/`. Recordings capture
  the complete event stream â€” Claude actions, tool calls, API responses, file changes, token usage,
  and phase timings â€” so you can replay, analyze, and share any execution after the fact.
</Callout>

## Recording Format

Recordings are stored as directories under `~/.pilot/recordings/`, each identified by a
timestamp-based ID (e.g., `TG-1738900000000`).

```
~/.pilot/recordings/
â””â”€â”€ TG-1738900000000/
    â”œâ”€â”€ metadata.json     # Recording metadata and token usage
    â”œâ”€â”€ stream.jsonl      # Full event stream (one JSON object per line)
    â”œâ”€â”€ diffs/
    â”‚   â””â”€â”€ changes.json  # File operations tracked during execution
    â””â”€â”€ summary.md        # Human-readable summary
```

### JSONL Event Stream

Each line in `stream.jsonl` is a self-contained JSON object representing one event:

```json
{
  "timestamp": "2026-02-07T14:23:01.456Z",
  "sequence": 42,
  "raw": "{...}",
  "type": "assistant",
  "parsed": {
    "type": "assistant",
    "tool_name": "Edit",
    "tool_input": { "file_path": "internal/config/config.go", "old_string": "...", "new_string": "..." },
    "file_path": "internal/config/config.go",
    "file_operation": "modify"
  }
}
```

### Captured Data

| Category | Fields |
|----------|--------|
| **Claude actions** | Assistant text, reasoning, tool selections |
| **Tool calls** | Tool name, full input parameters, file paths |
| **API responses** | Result text, error status, token counts per turn |
| **File diffs** | File path, operation (`create`/`modify`/`delete`), timestamps |
| **Token usage** | Input tokens, output tokens, total, estimated cost (USD) |
| **Phase timings** | Phase name, start/end timestamps, duration |

### Metadata Fields

Every recording carries structured metadata:

```json
{
  "id": "TG-1738900000000",
  "task_id": "GH-123",
  "project_path": "/home/user/my-project",
  "start_time": "2026-02-07T14:20:00Z",
  "end_time": "2026-02-07T14:35:12Z",
  "duration": "15m12s",
  "status": "completed",
  "event_count": 247,
  "metadata": {
    "branch": "pilot/GH-123",
    "base_branch": "main",
    "commit_sha": "a1b2c3d",
    "pr_url": "https://github.com/you/repo/pull/456",
    "has_navigator": true,
    "model_name": "claude-opus-4-6",
    "tags": {
      "complexity": "medium",
      "effort": "moderate"
    }
  },
  "token_usage": {
    "input_tokens": 48200,
    "output_tokens": 12350,
    "total_tokens": 60550,
    "estimated_cost_usd": 0.5493
  },
  "phase_timings": [
    { "phase": "Exploring", "duration": "3m20s" },
    { "phase": "Implementing", "duration": "8m45s" },
    { "phase": "Testing", "duration": "2m10s" },
    { "phase": "Committing", "duration": "57s" }
  ]
}
```

| Field | Description |
|-------|-------------|
| `branch` | Git branch created for the task |
| `base_branch` | Branch the task branched from |
| `commit_sha` | Final commit SHA after execution |
| `pr_url` | GitHub PR URL (if PR was created) |
| `has_navigator` | Whether Navigator `.agent/` was detected |
| `model_name` | Claude model used for execution |
| `tags` | Arbitrary key-value pairs (complexity, effort, custom) |

## CLI Commands

### `pilot replay list`

List recorded executions with optional filters.

```bash
# List all recordings
pilot replay list

# Filter by status
pilot replay list --status=failed

# Filter by project
pilot replay list --project=/path/to/repo

# Limit results
pilot replay list --limit=10 --since=24h
```

**Output:**

```
ID                    Task       Status     Duration  Events
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
TG-1738900000000      GH-123     completed  15m12s    247
TG-1738890000000      GH-119     failed     8m43s     156
TG-1738880000000      GH-117     completed  22m05s    412
```

### `pilot replay show <id>`

Display recording metadata, token usage, and phase timings without loading the full event stream.

```bash
pilot replay show TG-1738900000000
```

**Output:**

```
Recording:  TG-1738900000000
Task:       GH-123
Status:     completed
Duration:   15m12s
Events:     247

Metadata:
  Branch:     pilot/GH-123
  Commit:     a1b2c3d
  PR:         https://github.com/you/repo/pull/456
  Model:      claude-opus-4-6
  Navigator:  true

Token Usage:
  Input:      48,200 tokens
  Output:     12,350 tokens
  Total:      60,550 tokens
  Cost:       $0.5493
```

### `pilot replay play <id>`

Launch the interactive TUI viewer for step-by-step event replay.

```bash
# Basic replay
pilot replay play TG-1738900000000

# Start from a specific event
pilot replay play TG-1738900000000 --start=50

# Real-time playback at 2x speed
pilot replay play TG-1738900000000 --speed=2.0

# Filter to tool calls only
pilot replay play TG-1738900000000 --tools-only
```

See [TUI Viewer](#tui-viewer) below for keyboard controls.

### `pilot replay analyze <id>`

Generate a detailed analysis report with token and phase breakdowns.

```bash
pilot replay analyze TG-1738900000000
```

**Output:**

```
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
EXECUTION ANALYSIS REPORT
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Recording:  TG-1738900000000
Task:       GH-123
Status:     completed
Duration:   15m12s
Events:     247

TOKEN USAGE
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  Input:    48,200 tokens
  Output:   12,350 tokens
  Total:    60,550 tokens
  Cost:     $0.5493

PHASE ANALYSIS
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  Exploring:      3m20s ( 21.8%) 62 events
  Implementing:   8m45s ( 57.6%) 134 events
  Testing:        2m10s ( 14.3%) 38 events
  Committing:       57s (  6.3%) 13 events

TOOL USAGE
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  Read:          42 calls
  Edit:          28 calls
  Bash:          19 calls
  Grep:          15 calls
  Glob:          11 calls
  Write:          7 calls (2 errors)

ERRORS
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  #89  [14:26:12] Bash: exit code 1 â€” test failed
  #134 [14:29:45] Write: permission denied

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
```

See [Analysis Reports](#analysis-reports) below for report details.

### `pilot replay export <id>`

Export a recording to HTML, JSON, or Markdown format.

```bash
# HTML interactive report (default)
pilot replay export TG-1738900000000 --format=html --output=report.html

# Raw JSON data
pilot replay export TG-1738900000000 --format=json --output=recording.json

# Markdown summary
pilot replay export TG-1738900000000 --format=markdown --output=report.md
```

See [Export Formats](#export-formats) below for format details.

### `pilot replay delete <id>`

Delete a recording permanently.

```bash
pilot replay delete TG-1738900000000
```

<Callout type="warning">
  Deletion is permanent. The entire recording directory (metadata, stream, diffs, summary) is removed.
</Callout>

## TUI Viewer

The interactive viewer (`pilot replay play`) provides a full-screen terminal interface built
with [Bubble Tea](https://github.com/charmbracelet/bubbletea) for stepping through execution
events.

### Layout

```
 â–¶ TG-1738900000000  Task: GH-123
â¸ â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ [42/247] 1.0x
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  14:23:01 #38  ğŸ“– Read: .../config/config.go
  14:23:02 #39  ğŸ’¬ I see the config struct needs...
  14:23:03 #40  ğŸ“ Edit: .../config/config.go
  14:23:04 #41  ğŸ“¥ Tool result
â–¶ 14:23:05 #42  ğŸ’» Bash: go build ./...
  14:23:08 #43  âœ… Completed (2,100 in, 450 out)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Showing: Tools, Text, Results, System, Errors
Space: Play/Pause â”‚ â†â†’: Navigate â”‚ 1-4: Speed â”‚ ?: Help
```

### Keyboard Controls

| Key | Action |
|-----|--------|
| `Space`, `p` | Play/pause auto-playback |
| `n`, `Enter`, `â†“`, `j` | Next event |
| `N`, `â†‘`, `k` | Previous event |
| `g` | Jump to first event |
| `G` | Jump to last event |
| `PgUp`/`PgDn` | Jump 10 events |
| `1`â€“`4` | Set speed: 0.5x, 1x, 2x, 4x |
| `t` | Toggle tool call visibility |
| `x` | Toggle assistant text visibility |
| `r` | Toggle result visibility |
| `s` | Toggle system event visibility |
| `e` | Toggle error visibility |
| `a` | Show all events (reset filters) |
| `?`, `h` | Toggle help overlay |
| `q`, `Ctrl+C` | Quit viewer |

### Event Icons

| Icon | Event Type |
|------|------------|
| ğŸ“– | `Read` â€” file read |
| âœï¸ | `Write` â€” file create |
| ğŸ“ | `Edit` â€” file modify |
| ğŸ’» | `Bash` â€” command execution |
| ğŸ” | `Glob` / `WebSearch` â€” pattern/search |
| ğŸ” | `Grep` â€” content search |
| ğŸ¤– | `Task` â€” subagent |
| âš¡ | `Skill` â€” skill invocation |
| ğŸŒ | `WebFetch` â€” URL fetch |
| ğŸ’¬ | Assistant text |
| ğŸ“¥ | Tool result received |
| âœ… | Execution completed |
| âŒ | Error |
| ğŸš€ | System initialized |
| âš™ï¸ | System event |

## Analysis Reports

The `analyze` command generates a structured `AnalysisReport` with five sections:

### Token Breakdown

Token usage split by execution phase and by tool:

- **By phase** â€” How many tokens each phase consumed (Research, Implementing, Verifying, etc.)
- **By tool** â€” Token cost attributed to each tool (Read, Edit, Bash, Grep, etc.)
- **Overhead** â€” System/initialization tokens not attributable to a specific phase

### Phase Duration

Wall-clock time spent in each detected phase as a percentage of total execution time. Phases
are detected from tool usage patterns and Navigator phase markers in assistant text:

| Phase | Detection Signal |
|-------|-----------------|
| Exploring | `Read`, `Glob`, `Grep` tool calls |
| Implementing | `Write`, `Edit` tool calls |
| Testing | `Bash` commands containing `test` |
| Committing | `Bash` commands containing `git commit` |
| Research | Navigator `PHASE: RESEARCH` text |
| Verifying | Navigator `PHASE: VERIFY` text |
| Completing | Navigator `PHASE: COMPLETE` text |

### Tool Usage Statistics

Per-tool metrics:

| Metric | Description |
|--------|-------------|
| Call count | Number of times the tool was invoked |
| Error count | Invocations that returned errors |
| Total time | Cumulative time spent in the tool |
| Average time | Mean duration per invocation |
| Input tokens | Tokens consumed by tool inputs |
| Output tokens | Tokens consumed by tool outputs |

### Error Tracking

All error events captured during execution with:

- Timestamp and sequence number
- Phase in which the error occurred
- Tool that produced the error (if applicable)
- Error message (truncated to 200 characters)

### Decision Points

Significant decisions detected from Navigator workflow patterns (`WORKFLOW CHECK`, `Decision:`,
`Approach:` markers). These highlight moments where the agent chose between approaches.

## Export Formats

<Tabs items={['HTML', 'JSON', 'Markdown']}>
  <Tabs.Tab>
### HTML â€” Interactive Report

A self-contained HTML file with dark-themed styling, summary cards, bar charts for phase
timing and token breakdown, tool usage grid, error list, and a scrollable execution timeline.

```bash
pilot replay export TG-1738900000000 --format=html --output=report.html
```

Features:
- Summary cards: duration, event count, total tokens, estimated cost, model name
- Token breakdown bar chart by phase
- Phase timing bar chart with percentage labels
- Tool usage grid with call counts and error indicators
- Error list with timestamps, phases, and messages
- Full execution timeline with color-coded event types
- Hover effects for timeline events

Open the file in any browser â€” no server required.
  </Tabs.Tab>
  <Tabs.Tab>
### JSON â€” Raw Data

The complete recording metadata and event stream serialized as a single JSON file.

```bash
pilot replay export TG-1738900000000 --format=json --output=recording.json
```

Structure:

```json
{
  "recording": {
    "id": "TG-1738900000000",
    "task_id": "GH-123",
    "metadata": { "..." },
    "token_usage": { "..." },
    "phase_timings": [ "..." ]
  },
  "events": [
    {
      "timestamp": "2026-02-07T14:23:01.456Z",
      "sequence": 1,
      "type": "system",
      "parsed": { "..." }
    }
  ]
}
```

Use this format for programmatic analysis, custom dashboards, or feeding into other tools.
  </Tabs.Tab>
  <Tabs.Tab>
### Markdown â€” Text Report

A Markdown document with metadata table, token usage, phase timing table, tool usage table,
error details, and a collapsible event timeline.

```bash
pilot replay export TG-1738900000000 --format=markdown --output=report.md
```

Sections:
- **Summary** â€” Property/value table with task ID, project, duration, branch, commit, PR, model
- **Token Usage** â€” Input, output, total, and estimated cost
- **Phase Timing** â€” Table with phase, duration, percentage, and event count
- **Tool Usage** â€” Table with tool, calls, errors, and tokens
- **Errors** â€” Individual error blocks with timestamps and messages
- **Event Timeline** â€” Full event log inside a `<details>` block

Suitable for pasting into GitHub issues, PR descriptions, or team documentation.
  </Tabs.Tab>
</Tabs>

## Use Cases

### Debugging Failed Tasks

When a task fails, replay the execution to find where things went wrong:

```bash
# Find the failed recording
pilot replay list --status=failed --limit=5

# Check the summary
pilot replay show TG-1738890000000

# Step through events interactively
pilot replay play TG-1738890000000

# Generate a report to share with the team
pilot replay export TG-1738890000000 --format=html --output=failure-report.html
```

Filter to errors only in the TUI viewer by pressing `e` to toggle error visibility, then
`t`, `x`, `r`, `s` to hide other event types.

### Understanding Token Usage

Compare token efficiency across executions:

```bash
# Analyze a specific recording
pilot replay analyze TG-1738900000000

# Export for comparison
pilot replay export TG-1738900000000 --format=json --output=run1.json
pilot replay export TG-1738910000000 --format=json --output=run2.json
```

The phase breakdown reveals where tokens are spent â€” if `Exploring` consumes 60%+ of tokens,
the task might benefit from better Navigator documentation to reduce codebase search.

### Sharing Execution Details

Export recordings to share with teammates for review or post-mortems:

```bash
# Interactive HTML report for browsing
pilot replay export TG-1738900000000 --format=html --output=report.html

# Markdown for GitHub issues
pilot replay export TG-1738900000000 --format=markdown --output=report.md
```

## Related

- **[CLI Reference](/cli/commands)** â€” Full CLI command documentation
- **[Autopilot Mode](/features/autopilot)** â€” Autonomous execution that generates recordings
- **[Model Routing](/concepts/model-routing)** â€” How model selection affects token usage and cost
