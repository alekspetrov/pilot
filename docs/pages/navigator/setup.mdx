import { Callout, Steps } from 'nextra/components'

# Setting Up Navigator

Navigator activates automatically when Pilot detects a `.agent/` directory in your project.
This page covers how to initialize Navigator, structure your documentation, and verify
the integration.

<Callout type="info">
  Navigator is a Claude Code plugin installed separately. Pilot only needs the `.agent/`
  directory â€” it handles the rest automatically.
</Callout>

## Prerequisites

- **Pilot** installed and configured (`pilot doctor` passes)
- **Claude Code** installed with Navigator plugin
- A project repository with at least one commit

## Initialize the `.agent/` Directory

<Steps>

### Create the directory structure

```bash
mkdir -p .agent/system .agent/tasks .agent/memories .agent/sops .agent/.context-markers
```

This creates the standard Navigator layout:

```
.agent/
â”œâ”€â”€ DEVELOPMENT-README.md     # Index document (loaded every session)
â”œâ”€â”€ system/                    # Architecture and system docs
â”‚   â”œâ”€â”€ ARCHITECTURE.md        # System design, data flow
â”‚   â”œâ”€â”€ FEATURE-MATRIX.md      # What's implemented vs planned
â”‚   â””â”€â”€ PR-CHECKLIST.md        # Pre-merge verification
â”œâ”€â”€ tasks/                     # Task implementation plans
â”‚   â””â”€â”€ archive/               # Completed task docs
â”œâ”€â”€ memories/                  # Knowledge graph entries
â”œâ”€â”€ sops/                      # Standard Operating Procedures
â””â”€â”€ .context-markers/          # Session save points
```

### Write the index document

Create `.agent/DEVELOPMENT-README.md` â€” this is the only file Navigator loads at session
start. Keep it under **500 words** (~2k tokens).

```markdown
# Project Name â€” Development Navigator

## Quick Navigation

| Document | When to Read |
|----------|-------------|
| This file | Every session (auto-loaded) |
| `system/ARCHITECTURE.md` | System design, data flow |
| `system/FEATURE-MATRIX.md` | What's implemented vs not |
| `tasks/TASK-XX.md` | Active task details |

## Current State

**Version:** v1.0.0

### Key Components

| Component | Status | Notes |
|-----------|--------|-------|
| API Server | Working | Express + TypeScript |
| Database | Working | PostgreSQL + Prisma |
| Auth | In Progress | JWT-based |

## Project Structure

\`\`\`
project/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ api/          # Route handlers
â”‚   â”œâ”€â”€ services/     # Business logic
â”‚   â””â”€â”€ models/       # Database models
â”œâ”€â”€ tests/
â””â”€â”€ .agent/           # Navigator docs
\`\`\`

## Active Work

_See GitHub Issues with `pilot` label for current queue._
```

### Configure CLAUDE.md

Add Navigator instructions to your project's `CLAUDE.md` so Claude Code knows
to use it:

```markdown
## Navigator Integration

This project uses Navigator for context management.
Documentation lives in `.agent/`.

### Quick Commands
- `/nav-start` â€” Start or resume Navigator session
- `/nav-task "description"` â€” Plan a new task
- `/nav-compact` â€” Clear context when done with a task
```

### Verify the setup

Run Pilot to confirm Navigator detection:

```bash
pilot task --dry-run "Test Navigator detection"
```

The output should include:

```
ğŸ§­ Navigator: âœ“ detected (.agent/ exists)
```

If you see `âš ï¸ Navigator: not found`, check that `.agent/DEVELOPMENT-README.md` exists.

</Steps>

## Directory Reference

### `DEVELOPMENT-README.md` (Required)

The index document. Loaded every session. Contains:
- Quick navigation table linking to other docs
- Current project state and version
- Key component status
- Project structure overview
- Active work references

**Target size:** Under 500 words (~2,000 tokens).

### `system/` (Recommended)

Architecture and system-level documentation:

| File | Purpose |
|------|---------|
| `ARCHITECTURE.md` | System design, data flow, package map |
| `FEATURE-MATRIX.md` | Implementation status of all features |
| `PR-CHECKLIST.md` | Pre-merge verification steps |

These are loaded on demand when tasks touch architecture.

### `tasks/` (Recommended)

Task implementation plans created by `/nav-task`. Each task gets a markdown file with:
- Requirements analysis
- Implementation steps
- Affected files
- Test plan
- Post-completion archive with learnings

Completed tasks move to `tasks/archive/`.

### `memories/` (Optional)

Knowledge graph entries â€” decisions, patterns, and pitfalls captured during development.
Navigator creates and queries these automatically.

### `sops/` (Optional)

Standard Operating Procedures for recurring workflows:
- Release process
- Integration testing
- Deployment steps

### `.context-markers/` (Auto-managed)

Session save points created by Navigator. Do not manually edit these files.
Format: `YYYY-MM-DD-HHMM_description.md`

### `.nav-config.json` (Optional)

Navigator configuration overrides:

```json
{
  "version": "6.1.0",
  "features": {
    "knowledge_graph": true,
    "user_profile": true,
    "loop_mode": true
  }
}
```

### `.user-profile.json` (Auto-managed)

User preferences learned by Navigator's bilateral modeling system:

```json
{
  "verbosity": "concise",
  "confirmation_threshold": "low",
  "framework_preferences": ["Go", "TypeScript"],
  "correction_patterns": []
}
```

## Configuration in `config.yaml`

Enable Navigator per project in your Pilot configuration:

```yaml
# ~/.pilot/config.yaml
projects:
  - name: "my-project"
    path: "/path/to/project"
    navigator: true    # Pilot checks for .agent/ before each task
```

When `navigator: true`, Pilot will prefix Claude Code prompts with
`"Start my Navigator session"` if `.agent/` exists in the project path.

## Troubleshooting

| Symptom | Cause | Fix |
|---------|-------|-----|
| `Navigator: not found` in output | Missing `.agent/` directory | Run `mkdir -p .agent` and create index |
| Navigator loads but burns tokens | Index document too large | Keep `DEVELOPMENT-README.md` under 500 words |
| Knowledge graph empty | No memories captured yet | Memories accumulate automatically over tasks |
| Context markers missing | First session | Markers created when using `/nav-marker` or `/nav-compact` |
| Phase progress stuck | Navigator signals not detected | Verify Claude Code has Navigator plugin installed |
