# GH-1078

**Created:** 2026-02-14

## Problem

GitHub Issue #1078: perf(executor): implement worktree pool for sequential mode

## Context — Post v1.0 Performance Optimization (P1)

**Impact: Save 500ms-2s per task in sequential mode**

## Problem

`CreateWorktreeWithBranch()` (worktree.go:145) creates a fresh git worktree per task, then destroys it on completion. In sequential mode (default), this overhead repeats for every issue.

## Implementation

Add `WorktreePool` to `WorktreeManager` in `internal/executor/worktree.go`:

- `pool []*PooledWorktree` — pre-created worktrees
- `poolSize int` — configurable, default 2
- `Acquire(branch string) (*WorktreeResult, error)` — get from pool, switch branch
- `Release(wt *WorktreeResult)` — reset and return to pool

### Pool Lifecycle
1. **Init:** Create `poolSize` worktrees at Runner startup (warm pool)
2. **Acquire:** `git clean -fd && git checkout -B <branch>` inside existing worktree
3. **Release:** Validate clean state, return to pool
4. **Fallback:** If pool empty, use `CreateWorktreeWithBranch()` (current behavior)
5. **Shutdown:** Drain pool via `WorktreeManager.Close()`

### Config
```yaml
executor:
  use_worktree: true
  worktree_pool_size: 2  # 0 = no pooling (current behavior)
```

### Safety
- Pool paths: `/tmp/pilot-worktree-pool-N/`
- `Acquire()` always does `git clean -fd` to ensure clean state
- `Release()` validates before returning to pool
- Navigator copy uses diff-based update on reuse (skip unchanged files)

### Files
- `internal/executor/worktree.go` — Pool logic (Acquire, Release, warmup)
- `internal/executor/worktree_test.go` — Pool lifecycle tests
- `internal/config/config.go` — Add `WorktreePoolSize int`
- `internal/executor/runner.go` — Wire pool in `executeWithOptions()`

## Acceptance Criteria

- [ ] Pool creates worktrees at startup when configured
- [ ] Acquire returns existing worktree with clean branch
- [ ] Release returns worktree to pool (not destroyed)
- [ ] Fallback to create when pool empty
- [ ] Clean shutdown drains pool
- [ ] `go test -race ./internal/executor/...` passes
- [ ] `pool_size: 0` preserves current behavior exactly

## Acceptance Criteria

