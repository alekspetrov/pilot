# GH-1830

**Created:** 2026-02-25

## Problem

GitHub Issue #1830: feat(adapters): Add Plane.so poller with parallel execution

## Parent: #1827
## DependsOn: #1828, #1829

### What
Create the Plane.so poller that polls for issues with `pilot` label and dispatches them for execution with parallel support.

### Files to Create
- `internal/adapters/plane/poller.go` — Main poller (copy Jira poller ~90%)

### Reference (copy pattern from)
- `internal/adapters/jira/poller.go` — Primary reference (90% reuse)
- `internal/adapters/asana/poller.go` — String-ID reference

### Poller Structure
```go
type Poller struct {
    client         *Client
    config         *Config
    interval       time.Duration
    processed      map[string]bool
    mu             sync.RWMutex
    onIssue        func(ctx context.Context, issue *WorkItem) (*IssueResult, error)
    maxConcurrent  int
    semaphore      chan struct{}
    activeWg       sync.WaitGroup
    stopping       atomic.Bool
    wgMu           sync.Mutex
    processedStore ProcessedStore
    onPRCreated    func(prNumber int, prURL, issueID, headSHA, branchName string)
    log            *slog.Logger
    // Label UUID cache
    pilotLabelID       string
    inProgressLabelID  string
    doneLabelID        string
    failedLabelID      string
}
```

### Required Behavior
1. **Startup**: Cache label UUIDs (resolve `pilot`, `pilot-in-progress`, `pilot-done`, `pilot-failed` by name)
2. **Startup**: Recover orphaned issues (find `pilot-in-progress`, remove label)
3. **Poll loop**: List work items with `pilot` label, skip processed, dispatch async
4. **On dispatch**: Add `pilot-in-progress` label
5. **On success**: Remove `pilot-in-progress`, add `pilot-done`, call OnPRCreated
6. **On failure**: Remove `pilot-in-progress`, add `pilot-failed`
7. **Parallel**: Semaphore + WaitGroup with `maxConcurrent` limit
8. **Filter**: Only process issues from configured `project_ids`

### PollerOption Pattern
```go
type PollerOption func(*Poller)
WithOnIssue(fn) / WithProcessedStore(store) / WithMaxConcurrent(n)
WithOnPRCreated(fn) / WithPollerLogger(logger)
```

### IssueResult
```go
type IssueResult struct {
    Success    bool
    PRNumber   int
    PRURL      string
    HeadSHA    string
    BranchName string
    Error      error
}
```

### Label Management Note
Plane assigns labels as UUID array on work items. To add/remove a label:
1. GET work item → read current `labels` array
2. Append/filter UUID
3. PATCH work item with updated `labels` array

### Acceptance Criteria
- [ ] Poller starts, caches label UUIDs, recovers orphans
- [ ] Polls at configured interval, dispatches new issues
- [ ] Parallel execution with semaphore
- [ ] ProcessedStore integration for dedup
- [ ] Label lifecycle: in-progress → done/failed
- [ ] OnPRCreated callback wired
- [ ] Unit tests for poller logic

## Acceptance Criteria

